SELECT RELACIONAMENTO.CODPROD,
       RELACIONAMENTO.DESCRICAO,
       RELACIONAMENTO.EMBALAGEM,
       RELACIONAMENTO.UNIDADE,
       RELACIONAMENTO.CODFAB,
       RELACIONAMENTO.CODMARCA,
       RELACIONAMENTO.MARCA,
       TO_NUMBER(RELACIONAMENTO.CODUSUR) CODUSUR,
       RELACIONAMENTO.RCA,
       TO_NUMBER(RELACIONAMENTO.CODSUPERVISOR) CODSUPERVISOR,
       RELACIONAMENTO.SUPERV,
SUM(NVL(VENDAS.QT,0)) QT,
SUM(NVL(VENDAS.PVENDA,0)) PVENDA,
SUM(NVL(VENDAS.TOTPESO,0)) TOTPESO,
SUM(NVL(VENDAS.Volume,0)) Volume,
SUM(NVL(VENDAS.Litragem,0)) Litragem,
SUM(NVL(VENDAS.TOTQTUNIT,0)) TOTQTUNIT,
SUM(NVL(VENDAS.TOTQTUNIT,0)) TOTQTUNIT,
SUM(NVL(VENDAS.QTCLIPOS,0)) QTCLIPOS,
SUM(NVL(METAS.VLMETA,0)) VLMETA,
SUM(NVL(METAS.QTPESOMETA,0)) QTPESOMETA,
SUM(NVL(METAS.QTMETA,0)) QTMETA,
SUM(NVL(METAS.MIXPREV,0)) MIXPREV,
SUM(NVL(METAS.CLIPOSPREV,0)) CLIPOSPREV
FROM  (/* SQL UTILIZADO PELA ROTINA PCSIS322 RELATORIO(S) - 17, 41 */ SELECT PCPRODUT.CODPROD,
               PCPRODUT.DESCRICAO,
               PCPRODUT.EMBALAGEM,
               PCPRODUT.UNIDADE,
               PCPRODUT.CODFAB,
               PCUSUARI.CODUSUR,
               PCPRODUT.CODMARCA,
               PCMARCA.MARCA,
               PCUSUARI.NOME AS RCA,
               PCUSUARI.CODSUPERVISOR,
               (/* SQL UTILIZADO PELA ROTINA PCSIS322 RELATORIO(S) - 17, 41 */ SELECT SUP.NOME FROM PCSUPERV SUP WHERE 
SUP.CODSUPERVISOR = PCUSUARI.CODSUPERVISOR) AS SUPERV
        FROM   PCPRODUT,
               PCFORNEC,
               PCUSUARI,
               PCSUPERV,
               PCMARCA, PCDEPTO, PCSECAO
        WHERE  PCUSUARI.CODSUPERVISOR NOT IN ('9999') 
        AND PCPRODUT.CODFORNEC = PCFORNEC.CODFORNEC(+) 
        AND PCUSUARI.CODSUPERVISOR = PCSUPERV.CODSUPERVISOR(+) 
        AND PCPRODUT.CODSEC = PCSECAO.CODSEC(+) 
        AND PCPRODUT.CODMARCA = PCMARCA.CODMARCA(+)
        AND PCPRODUT.CODEPTO = PCDEPTO.CODEPTO(+)
              -- filtros de produto, departamento, seção, fornecedor, etc..

AND PCPRODUT.CODFORNEC IN(3809)
              --  podem ser adicionados nesta consulta
        ) RELACIONAMENTO,
       (/* SQL UTILIZADO PELA ROTINA PCSIS322 RELATORIO(S) - 17, 41 */ SELECT PCPEDI.CODPROD,
 PCPEDC.CODUSUR  CODUSUR , 
 PCPEDC.CODSUPERVISOR  CODSUPERVISOR,
               COUNT(DISTINCT(PCPEDC.CODCLI)) AS QTCLIPOS,
               SUM(ROUND(NVL(PCPEDI.QT,
                       0) *(NVL(PCPEDI.PVENDA, 0) + NVL(PCPEDI.VLOUTRASDESP, 0) + NVL(PCPEDI.VLFRETE, 0)),2)) AS PVENDA,
       SUM(PCPEDI.QT) AS QT,
               SUM(ROUND(NVL(PCPEDI.QT,
                       0) * NVL(PCPRODUT.PESOBRUTO,
                                0),2)) AS TOTPESO,
               SUM(ROUND(NVL(PCPEDI.QT,
                       0) * NVL(PCPRODUT.VOLUME,
                                0),2)) Volume,
       ROUND(SUM(NVL(PCPRODUT.LITRAGEM, 0)*NVL(PCPEDI.QT,0)) ,2) LITRAGEM,
       SUM(NVL(PCPEDI.QT,0) / DECODE(NVL(PCPRODUT.QTUNIT,0),0,1,NVL(PCPRODUT.QTUNIT,1))) TOTQTUNIT,
       SUM(NVL(PCPEDI.QT,0) / DECODE(NVL(PCPRODUT.QTUNITCX,0),0,1,NVL(PCPRODUT.QTUNITCX,1))) TOTQTUNITCX
        FROM   PCPEDI   ,
               PCPEDC   ,
               PCPRODUT ,
               PCFORNEC ,
               PCUSUARI ,
               PCCLIENT ,
               PCPRACA  ,
               PCSECAO  ,
               PCDEPTO  ,
               PCATIVI   
        WHERE  
--TRUNC(PCPEDC.DATA) BETWEEN :DATAI AND :DATAF
 PCPEDC.DATA >= to_date('01/12/2023','dd/mm/yyyy') AND PCPEDC.DATA <= to_date('31/12/2023','dd/mm/yyyy')
AND PCPEDI.DATA >= to_date('01/12/2023','dd/mm/yyyy') AND PCPEDI.DATA <= to_date('31/12/2023','dd/mm/yyyy')




        AND PCPRODUT.CODSEC = PCSECAO.CODSEC(+) 
        AND    PCPEDI.NUMPED = PCPEDC.NUMPED
        AND    PCPEDC.DTCANCEL IS NULL
     AND PCPEDC.CODFILIAL IN ('2')
       AND PCPEDC.CONDVENDA IN (1, 2, 3, 7, 9, 14, 15, 17, 18, 19, 98)
 AND NVL(PCPEDI.BONIFIC, 'N') =  'N' 

AND PCPRODUT.CODFORNEC IN(3026)
  AND (PCPRODUT.CODEPTO IN 
              ( SELECT CODIGON 
                FROM PCLIB 
                WHERE CODFUNC = 1261 -- H.Meneses
                AND CODTABELA = 2) ) 
        AND    PCPEDC.CODCLI = PCCLIENT.CODCLI(+)
        AND    PCPEDI.CODPROD = PCPRODUT.CODPROD(+)
        AND     PCPEDC.CODUSUR  = PCUSUARI.CODUSUR 
        AND    PCPRODUT.CODFORNEC = PCFORNEC.CODFORNEC(+)
        AND    PCPEDC.CODPRACA = PCPRACA.CODPRACA(+)
        AND    PCPRODUT.CODEPTO = PCDEPTO.CODEPTO(+)
        AND PCCLIENT.CODATV1 = PCATIVI.CODATIV(+) 
        GROUP  BY PCPEDI.CODPROD,
 PCPEDC.CODUSUR  ,
 PCPEDC.CODSUPERVISOR  ) VENDAS,
       (/* SQL UTILIZADO PELA ROTINA PCSIS322 RELATORIO(S) - 17, 41 */ SELECT M.CODIGO AS CODPROD,
               M.CODUSUR,
               U.CODSUPERVISOR,
               SUM(M.VLVENDAPREV) AS VLMETA,
               SUM(M.QTPESOPREV) AS QTPESOMETA,
               SUM(M.QTVENDAPREV) AS QTMETA,
               SUM(NVL(M.MIXPREV,0)) AS MIXPREV,
               SUM(NVL(M.CLIPOSPREV,0)) AS CLIPOSPREV
        FROM   PCMETA   M,
               PCUSUARI U,
               PCPRODUT P
        WHERE  U.CODSUPERVISOR NOT IN ('9999')
         --AND M.DATA BETWEEN :DATAI AND :DATAF

  AND M.DATA >= to_date('01/12/2023','dd/mm/yyyy') AND M.DATA <= to_date('31/12/2023','dd/mm/yyyy')

         AND M.TIPOMETA = 'P'
         AND M.CODIGO = P.CODPROD 
           AND M.CODFILIAL IN ('2')
        AND    M.CODUSUR = U.CODUSUR
        GROUP  BY M.CODIGO,
                  M.CODUSUR,
                  U.CODSUPERVISOR) METAS
WHERE  RELACIONAMENTO.CODPROD = VENDAS.CODPROD(+)
AND    RELACIONAMENTO.CODUSUR = VENDAS.CODUSUR(+)
AND    RELACIONAMENTO.CODPROD = METAS.CODPROD(+)
AND    RELACIONAMENTO.CODUSUR = METAS.CODUSUR(+)
AND    RELACIONAMENTO.CODSUPERVISOR NOT IN ('9999')
AND NVL(VENDAS.PVENDA,0)+NVL(VENDAS.TOTPESO,0) + NVL(VENDAS.QT,0)>0
GROUP BY RELACIONAMENTO.CODPROD,
RELACIONAMENTO.DESCRICAO,
RELACIONAMENTO.EMBALAGEM,
RELACIONAMENTO.UNIDADE,
RELACIONAMENTO.CODFAB,
RELACIONAMENTO.CODMARCA,
RELACIONAMENTO.MARCA,
RELACIONAMENTO.CODUSUR,
RELACIONAMENTO.RCA,
RELACIONAMENTO.CODSUPERVISOR,
RELACIONAMENTO.SUPERV
ORDER BY RELACIONAMENTO.CODSUPERVISOR, RELACIONAMENTO.CODUSUR, PVENDA DESC